<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>PPA Dashboard V1</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#020617,#0f172a,#020617);color:#e5e7eb;margin:0;padding:28px}
h1{margin-bottom:6px;font-weight:700;font-size:30px;letter-spacing:.5px}
p{color:#94a3b8}
textarea{width:100%;height:190px;border-radius:16px;border:1px solid #1e293b;padding:14px;font-size:13px;outline:none;white-space:pre;overflow:auto;background:#020617;color:#e5e7eb;box-shadow:inset 0 0 15px rgba(0,0,0,.5)}
.controls{display:flex;flex-wrap:wrap;gap:12px;margin-top:16px;align-items:center}
select,button{padding:10px 16px;border-radius:14px;border:none;font-weight:600;font-size:13px}
select{background:#020617;color:#e5e7eb;border:1px solid #1e293b}
button{cursor:pointer;transition:.25s;box-shadow:0 6px 18px rgba(0,0,0,.45)}
button:hover{transform:translateY(-2px);opacity:.92}
.btn-green{background:linear-gradient(135deg,#22c55e,#4ade80);color:#020617}
.btn-yellow{background:linear-gradient(135deg,#facc15,#fde047);color:#020617}
.btn-info{background:linear-gradient(135deg,#6366f1,#818cf8);color:#020617}
.info{margin-top:18px;font-size:14px;color:#cbd5f5}
.status-box{margin-top:18px;padding:16px;border-radius:18px;border:1px solid #1e293b;box-shadow:0 10px 25px rgba(0,0,0,.5)}
.status-ok{background:linear-gradient(135deg,#052e16,#022c22);border:1px solid #14532d}
.status-pendente{background:linear-gradient(135deg,#3f2a00,#1e1300);border:1px solid #854d0e}
.status-title{font-weight:700;font-size:15px;margin-bottom:6px}
.status-list{font-size:13px;color:#e5e7eb}
.about-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(2,6,23,.94);display:none;align-items:center;justify-content:center;z-index:20;backdrop-filter:blur(8px)}
.about-card{max-width:720px;background:linear-gradient(180deg,#020617,#0f172a);border-radius:22px;padding:26px;border:1px solid #1e293b;box-shadow:0 30px 80px rgba(0,0,0,.9)}
.about-card h2{margin-top:0;font-size:22px}
.about-card p{font-size:14px;line-height:1.6;color:#cbd5e1}
.about-footer{margin-top:16px;padding-top:12px;border-top:1px solid #1e293b;font-size:13px;color:#94a3b8}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:20px;margin-top:26px}
.card{background:linear-gradient(180deg,#020617,#020617,#0f172a);border-radius:20px;padding:12px;text-align:center;box-shadow:0 12px 28px rgba(0,0,0,.65);transition:.25s;border:1px solid #1e293b}
.card:hover{transform:translateY(-6px);box-shadow:0 22px 45px rgba(0,0,0,.85)}
.card img{width:100%;border-radius:14px;background:#fff;cursor:pointer}
.ref{font-size:12px;color:#38bdf8;margin-top:8px;font-weight:600}
.desc{font-size:11px;color:#cbd5e1;margin-top:4px}
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(2,6,23,.92);display:none;align-items:center;justify-content:center;z-index:10;backdrop-filter:blur(6px)}
.modal img{max-width:90%;max-height:90%;border-radius:18px;box-shadow:0 0 60px rgba(56,189,248,.4)}
</style>
</head>
<body>
<h1>PPA Dashboard V1</h1>
<p>Cole direto do PowerBi (Ctrl+C / Ctrl+V). Funciona com Google Sheets, Excel e CSV.</p>
<textarea id="input" placeholder="Cole aqui os dados do PPA..."></textarea>
<div class="controls">
<button class="btn-green" onclick="processar()">Processar PPA</button>
<select id="filtroLoja" onchange="aplicarFiltros()"><option value="">Todas as lojas</option></select>
<select id="filtroTime" onchange="aplicarFiltros()"><option value="">Todos os times</option></select>
<button class="btn-yellow" onclick="exportarCSV()">ðŸ“¥ Exportar CSV</button>
<button class="btn-info" onclick="abrirSobre()">Sobre o projeto</button>
</div>

<div class="info" id="contador"></div>
<div id="lojasOk" class="status-box status-ok"></div>
<div id="lojasPendentesBox" class="status-box status-pendente"></div>
<div class="grid" id="resultado"></div>
<div class="modal" id="modal" onclick="fecharModal()"><img id="modalImg"></div>

<div class="about-modal" id="aboutModal" onclick="fecharSobre()">
  <div class="about-card" onclick="event.stopPropagation()">
    <h2>ðŸ“Š PPA Dashboard Alternativo</h2>
    <p>
      Este nÃ£o Ã© um projeto oficial. Trata-se de um <b>projeto alternativo</b> criado para apoiar as regionais no aumento da aderÃªncia ao PPA de forma mais eficaz.
      <br><br>
      Atualmente, o aplicativo <b>PPA 2.0</b> ainda nÃ£o possui capacidade total de sincronizaÃ§Ã£o em tempo real.
      <br><br>
      Este dashboard permite identificar divergÃªncias reais por loja e visualizar exatamente o que estÃ¡ faltando no PPA.
    </p>
    <div class="about-footer">
      Criador: <b>JoÃ£o Gabriel</b><br>
      Cargo: Supervisor de Clientes â€“ CE0254<br>
      Regional: <b>GuardiÃµes da Fronteira</b>
    </div>
  </div>
</div>

<script>
function abrirSobre(){document.getElementById('aboutModal').style.display='flex'}
function fecharSobre(){document.getElementById('aboutModal').style.display='none'}
let pendentes = [];

function detectarSeparador(linha){
    if(linha.includes('\t')) return '\t';
    if(linha.includes(';')) return ';';
    if(linha.includes(',')) return ',';
    return ' ';
}

function normalizar(t){
    return t.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
}

function processar(){
    const texto = document.getElementById('input').value.trim();
    if(!texto) return;

    const linhas = texto.split(/\r?\n/).filter(l=>l.trim()!='');
    const sep = detectarSeparador(linhas[0]);

    const header = linhas[0].split(sep).map(h=>normalizar(h));

    const idx = {
        loja: header.findIndex(h=>h.includes('cod_loja')||h==='loja'),
        ref: header.findIndex(h=>h.includes('cod_modelo')||h.includes('modelo')||h.includes('refer')),
        desc: header.findIndex(h=>h.includes('des_modelo')||h.includes('descricao')),
        time: header.findIndex(h=>h.includes('time')),
        finalizadas: header.findIndex(h=>h.includes('finalizada'))
    };

    pendentes = [];
    const lojasStatus = {};

    for(let i=1;i<linhas.length;i++){
        const col = linhas[i].split(sep);
        const loja = col[idx.loja] || '';
        const ref = col[idx.ref] || '';
        const desc = col[idx.desc] || '';
        const time = col[idx.time] || '';
        const finalizadas = col[idx.finalizadas] || '';

        if(!lojasStatus[loja]) lojasStatus[loja] = {total:0,pendente:0};
        lojasStatus[loja].total++;

        if(finalizadas.trim()==='0'){
            lojasStatus[loja].pendente++;
            if(ref){ pendentes.push({loja,ref,desc,time}); }
        }
    }

    const lojasOk = Object.keys(lojasStatus).filter(l=>lojasStatus[l].pendente===0 && lojasStatus[l].total>0);
    const lojasPend = Object.keys(lojasStatus).filter(l=>lojasStatus[l].pendente>0);

    montarFiltros();
    render(pendentes);

    const boxOk = document.getElementById('lojasOk');
    const boxPend = document.getElementById('lojasPendentesBox');

    boxOk.innerHTML = lojasOk.length
        ? `<div class="status-title">ðŸŸ¢ Lojas 100% concluÃ­das (${lojasOk.length})</div><div class="status-list">${lojasOk.join(' , ')}</div>`
        : `<div class="status-title">ðŸŸ¢ Lojas 100% concluÃ­das</div><div class="status-list">Nenhuma loja 100% ainda</div>`;

    boxPend.innerHTML = lojasPend.length
        ? `<div class="status-title">ðŸŸ¡ Lojas com pendÃªncias (${lojasPend.length})</div><div class="status-list">${lojasPend.join(' , ')}</div>`
        : `<div class="status-title">ðŸŸ¡ Lojas com pendÃªncias</div><div class="status-list">Nenhuma pendÃªncia detectada</div>`;
}

function montarFiltros(){
    const lojas=[...new Set(pendentes.map(p=>p.loja).filter(v=>v))];
    const times=[...new Set(pendentes.map(p=>p.time).filter(v=>v))];

    const fLoja=document.getElementById('filtroLoja');
    const fTime=document.getElementById('filtroTime');

    fLoja.innerHTML='<option value="">Todas as lojas</option>';
    fTime.innerHTML='<option value="">Todos os times</option>';

    lojas.forEach(l=>{const o=document.createElement('option');o.value=l;o.textContent=l;fLoja.appendChild(o);});
    times.forEach(t=>{const o=document.createElement('option');o.value=t;o.textContent=t;fTime.appendChild(o);});
}

function aplicarFiltros(){
    const loja=document.getElementById('filtroLoja').value;
    const time=document.getElementById('filtroTime').value;
    let f=pendentes;
    if(loja) f=f.filter(p=>p.loja===loja);
    if(time) f=f.filter(p=>p.time===time);
    render(f);
}

function render(lista){
    const grid=document.getElementById('resultado');
    const contador=document.getElementById('contador');
    grid.innerHTML='';
    contador.innerHTML=`ðŸ“Š PendÃªncias detectadas automaticamente: <b>${lista.length}</b>`;

    lista.forEach(p=>{
        const imgUrl=`http://imgcentauro-a.akamaihd.net/900x900/${p.ref}.jpg`;
        const card=document.createElement('div');
        card.className='card';
        card.innerHTML=`
            <img src="${imgUrl}" onerror="this.src='https://via.placeholder.com/900x900?text=SEM+IMAGEM'" onclick="abrirModal('${imgUrl}')">
            <div class="ref">${p.ref}</div>
            <div class="desc">${p.desc}</div>`;
        grid.appendChild(card);
    });
}

function abrirModal(src){document.getElementById('modalImg').src=src;document.getElementById('modal').style.display='flex'}
function fecharModal(){document.getElementById('modal').style.display='none'}

function exportarCSV(){
    let csv='loja,referencia,descricao,time\n';
    pendentes.forEach(p=>{csv+=`${p.loja},${p.ref},"${p.desc}",${p.time}\n`;});
    const blob=new Blob([csv],{type:'text/csv'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;a.download='ppa_pendentes.csv';a.click();
}
</script>
</body>
</html>